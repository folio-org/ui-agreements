{
  "name": "GOKb Search",
  "version": "1.0",
  "type": {
    "name": "SASQRouteConfig",
    "version": "1.0"
  },
  "configuration": {
    "results": {
      "display": {
        "columns": [
          {
            "name": "name",
            "type": "String",
            "sortable": true,
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.name"
            }
          },
          {
            "name": "publicationType",
            "type": "String",
            "value": {
              "type": "Handlebars",
              "templateString": "{{{replace this 'Instance' ''}}}",
              "value": {
                "type": "access",
                "accessType": "JSONPath",
                "expression": "$.componentType"
              }
            }
          },
          {
            "name": "isbns",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.identifiers[?(@.namespace == 'isbn' || @.namespace == 'eisbn' || @.namespace == 'pisbn')].value"
            }
          },
          {
            "name": "issns",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.identifiers[?(@.namespace == 'issn' || @.namespace == 'eissn' || @.namespace == 'pissn')].value"
            }
          },
          {
            "name": "zdbids",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.identifiers[?(@.namespace == 'zdb')].value"
            }
          },
          {
            "name": "ezbids",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.identifiers[?(@.namespace == 'ezb')].value"
            }
          },
          {
            "name": "publicationDates",
            "type": "Object",
            "renderStrategy": {
              "type": "renderPublicationDates"
            },
            "value": {
              "type": "displayDates",
              "value": [
                {
                  "type": "access",
                  "accessType": "JSONPath",
                  "expression": "$.dateFirstOnline",
                  "key": "dateFirstOnline"
                },
                {
                  "type": "access",
                  "accessType": "JSONPath",
                  "expression": "$.dateFirstInPrint",
                  "key": "dateFirstInPrint"
                },
                {
                  "type": "access",
                  "accessType": "JSONPath",
                  "expression": "$.publishedFrom",
                  "key": "publishedFrom"
                },
                {
                  "type": "access",
                  "accessType": "JSONPath",
                  "expression": "$.publishedTo",
                  "key": "publishedTo"
                }
              ]
            }
          },
          {
            "name": "otherIds",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "HandlebarsEach",
              "templateString": "{{{namespaceName}}}: {{{value}}}",
              "value": {
                "type": "access",
                "accessType": "JSONPath",
                "expression": "$.identifiers[?(@.namespace != 'issn' && @.namespace != 'eissn' && @.namespace != 'pissn' && @.namespace != 'isbn' && @.namespace != 'eisbn' && @.namespace != 'pisbn' && @.namespace != 'zdb' && @.namespace != 'ezb')]"
              }
            }
          },
          {
            "name": "publisher",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.publisherName"
            }
          },
          {
            "name": "firstAuthor",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.firstAuthor"
            }
          },
          {
            "name": "firstEditor",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.firstEditor"
            }
          },
          {
            "name": "edition",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.editionStatement"
            }
          },
          {
            "name": "volume",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.volumeNumber"
            }
          },
          {
            "name": "subjects",
            "type": "Array",
            "arrayType": "String",
            "renderStrategy": {
              "type": "joinString",
              "separator": ", "
            },
            "value": {
              "type": "HandlebarsEach",
              "templateString": "{{{scheme}}}: {{{heading}}}",
              "value": {
                "type": "access",
                "accessType": "JSONPath",
                "expression": "$.subjects[*]"
              }
            }
          },
          {
            "name": "gokbid",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.id"
            }
          },
          {
            "name": "gokbuuid",
            "type": "String",
            "value": {
              "type": "access",
              "accessType": "JSONPath",
              "expression": "$.uuid"
            }
          }
        ]
      },
      "fetch": {
        "baseUrl": "https://gokbt.gbv.de/gokb/api/find",
        "mapping": {
          "results": "records",
          "totalRecords": "count"
        },
        "sort": {
          "type": "Handlebars",
          "templateString": "sort=name&{{#if (startsWith sort '-')}}order=desc{{else}}order=asc{{/if}}"
        },
        "search": {
          "type": "queryDropdown",
          "options": [
            {
              "name": "keyword",
              "type": "Handlebars",
              "templateString": "q={{query}}",
              "default": true
            },
            {
              "name": "nameAndAltNames",
              "type": "Handlebars",
              "templateString": "label={{query}}"
            },
            {
              "name": "name",
              "type": "Handlebars",
              "templateString": "name={{query}}"
            },
            {
              "name": "altname",
              "type": "Handlebars",
              "templateString": "altname={{query}}"
            },
            {
              "name": "identifiers",
              "type": "Handlebars",
              "templateString": "identifier={{query}}"
            },
            {
              "name": "eisbn",
              "type": "Handlebars",
              "templateString": "identifier=isbn,{{query}}"
            },
            {
              "name": "isbn",
              "type": "Handlebars",
              "templateString": "identifier=pisbn,{{query}}"
            },
            {
              "name": "eissn",
              "type": "Handlebars",
              "templateString": "identifier=eissn,{{query}}"
            },
            {
              "name": "issn",
              "type": "Handlebars",
              "templateString": "identifier=issn,{{query}}"
            },
            {
              "name": "ezb",
              "type": "Handlebars",
              "templateString": "identifier=ezb,{{query}}"
            },
            {
              "name": "zdb",
              "type": "Handlebars",
              "templateString": "identifier=zdb,{{query}}"
            },
            {
              "name": "uuid",
              "type": "Handlebars",
              "templateString": "uuid={{query}}"
            },
            {
              "name": "gokbId",
              "type": "Handlebars",
              "templateString": "id={{query}}"
            },
            {
              "name": "authorEditor",
              "type": "Handlebars",
              "templateString": "q={{query}}&qfields=firstAuthor&qfields=firstEditor"
            }
          ]
        },
        "filters": [
          {
            "name": "type",
            "filterPath": "componentType",
            "filterString": {
              "type": "Handlebars",
              "templateString": "{{{buildFilterString valuesArray 'componentType' '=' '&'}}}"
            },
            "type": "singleSelect",
            "values": [
              {
                "name": "all",
                "value": "Title",
                "default": true
              },
              {
                "name": "book",
                "value": "Book"
              },
              {
                "name": "database",
                "value": "Database"
              },
              {
                "name": "journal",
                "value": "Journal"
              },
              {
                "name": "other",
                "value": "Other"
              }
            ]
          }
        ],
        "actions": {},
        "pagination": {
          "type": "offset"
        }
      }
    },
    "view": {
      "fetch": {
        "baseUrl": "https://gokbt.gbv.de/gokb/api/find",
        "mapping": {
          "data": "records"
        },
        "viewQueryUrl": {
          "type": "Handlebars",
          "templateString": "{{endpoint}}?uuid={{resourceId}}"
        },
        "viewQueryIdentifierKey": "uuid"
      },
      "display": {
        "actions": {
          "type": "dropdown",
          "values": [
            {
              "name": "viewInRemoteKb",
              "type": "registry",
              "registryResource": "remoteKb",
              "registryRenderFunction": "viewInRemoteKbButton",
              "props": [
                {
                  "name": "url",
                  "value": {
                    "type": "handlebars",
                    "templateString": "https://gokbt.gbv.de/gokb-ui/title/{{resource.uuid}}"
                  }
                },
                {
                  "name": "remoteKbName",
                  "value": {
                    "type": "static",
                    "value": "GOKB"
                  }
                }
              ]
            },
            {
              "name": "viewInLocalKb",
              "type": "registry",
              "registryResource": "remoteKb",
              "registryRenderFunction": "viewInLocalKbButton",
              "props": [
                {
                  "name": "remoteId",
                  "value": {
                    "type": "access",
                    "accessType": "JSONPath",
                    "expression": "$.uuid"
                  }
                }
              ]
            }
          ]
        },
        "title": {
          "type": "access",
          "accessType": "JSONPath",
          "expression": "$.name"
        },
        "icon": "gokbTitle",
        "renderStrategy": {
          "type": "sections",
          "values": [
            {
              "name": "info",
              "collapsable": false,
              "renderStrategy": {
                "type": "rows",
                "values": [
                  {
                    "type": "row",
                    "colCount": "1",
                    "values": [
                      {
                        "type": "heading",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.name"
                        }
                      }
                    ]
                  },
                  {
                    "type": "row",
                    "colCount": "1",
                    "values": [
                      {
                        "type": "metadata",
                        "createdDate": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.dateCreated"
                        },
                        "lastUpdatedDate": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.lastUpdatedDisplay"
                        }
                      }
                    ]
                  },
                  {
                    "type": "row",
                    "colCount": "3",
                    "values": [
                      {
                        "type": "keyValue",
                        "name": "publicationType",
                        "value": {
                          "type": "handlebars",
                          "templateString": "{{{replace this 'Instance' ''}}}",
                          "value": {
                            "type": "access",
                            "accessType": "JSONPath",
                            "expression": "$.componentType"
                          }
                        }
                      },
                      {
                        "name": "firstAuthor",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.firstAuthor"
                        }
                      },
                      {
                        "name": "firstEditor",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.firstEditor"
                        }
                      }
                    ]
                  },
                  {
                    "type": "row",
                    "colCount": "4",
                    "values": [
                      {
                        "name": "publicationDates",
                        "type": "keyValue",
                        "value": {
                          "type": "displayDates",
                          "value": [
                            {
                              "type": "access",
                              "accessType": "JSONPath",
                              "expression": "$.dateFirstOnline",
                              "key": "dateFirstOnline"
                            },
                            {
                              "type": "access",
                              "accessType": "JSONPath",
                              "expression": "$.dateFirstInPrint",
                              "key": "dateFirstInPrint"
                            },
                            {
                              "type": "access",
                              "accessType": "JSONPath",
                              "expression": "$.publishedFrom",
                              "key": "publishedFrom"
                            },
                            {
                              "type": "access",
                              "accessType": "JSONPath",
                              "expression": "$.publishedTo",
                              "key": "publishedTo"
                            }
                          ]
                        }
                      },
                      {
                        "name": "volume",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.volumeNumber"
                        }
                      },
                      {
                        "name": "edition",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.editionStatement"
                        }
                      },
                      {
                        "name": "publisher",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.publisherName"
                        }
                      }
                    ]
                  },
                  {
                    "type": "row",
                    "colCount": "2",
                    "values": [
                      {
                        "name": "gokbid",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.id"
                        }
                      },
                      {
                        "name": "gokbuuid",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.uuid"
                        }
                      }
                    ]
                  },
                  {
                    "type": "row",
                    "colCount": "5",
                    "values": [
                      {
                        "name": "issns",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.identifiers[?(@.namespace == 'issn' || @.namespace == 'eissn' || @.namespace == 'pissn')].value"
                        }
                      },
                      {
                        "name": "isbns",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.identifiers[?(@.namespace == 'isbn' || @.namespace == 'eisbn' || @.namespace == 'pisbn')].value"
                        }
                      },
                      {
                        "name": "zdbids",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.identifiers[?(@.namespace == 'zdb')].value"
                        }
                      },
                      {
                        "name": "ezbids",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.identifiers[?(@.namespace == 'ezb')].value"
                        }
                      },
                      {
                        "name": "dois",
                        "type": "keyValue",
                        "value": {
                          "type": "access",
                          "accessType": "JSONPath",
                          "expression": "$.identifiers[?(@.namespace == 'doi')].value"
                        }
                      }
                    ]
                  }
                ]
              }
            },
            {
              "name": "accordions",
              "collapsable": true,
              "renderStrategy": {
                "type": "accordionset",
                "values": [
                  {
                    "name": "extendedTitleInformation",
                    "collapsable": true,
                    "renderStrategy": {
                      "type": "rows",
                      "values": [
                        {
                          "type": "table",
                          "resource": {
                            "type": "access",
                            "accessType": "JSONPath",
                            "expression": "$.altname[*]"
                          },
                          "columns": [
                            {
                              "name": "altNames",
                              "type": "String",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.altNames"
                              }
                            }
                          ]
                        },
                        {
                          "type": "table",
                          "resource": {
                            "type": "access",
                            "accessType": "JSONPath",
                            "expression": "$.identifiers[*]"
                          },
                          "columns": [
                            {
                              "name": "type",
                              "type": "String",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.namespaceName"
                              }
                            },
                            {
                              "name": "identifier",
                              "type": "String",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.value"
                              }
                            }
                          ]
                        },
                        {
                          "type": "table",
                          "resource": {
                            "type": "access",
                            "accessType": "JSONPath",
                            "expression": "$.subjects[*]"
                          },
                          "columns": [
                            {
                              "name": "scheme",
                              "type": "String",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.scheme"
                              }
                            },
                            {
                              "name": "heading",
                              "type": "String",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.heading"
                              }
                            }
                          ]
                        }
                      ]
                    }
                  },
                  {
                    "name": "packageTitles",
                    "collapsable": true,
                    "badge": {
                      "type": "fetch",
                      "endpoint": "https://gokbt.gbv.de/gokb-ui/title/{{resource.uuid}}",
                      "value": {
                        "type": "Handlebars",
                        "templateString": "{{agreements.length}}"
                      }
                    },
                    "renderStrategy": {
                      "type": "rows",
                      "values": [
                        {
                          "type": "registry",
                          "registryResource": "remoteKb",
                          "registryRenderFunction": "tippTable",
                          "props": [
                            {
                              "name": "resourceId",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.uuid"
                              }
                            }
                          ]
                        }
                      ]
                    }
                  },
                  {
                    "name": "eresourceAgreements",
                    "collapsable": true,
                    "badge": {
                      "type": "fetch",
                      "endpoint": "https://gokbt.gbv.de/gokb-ui/title/{{resource.uuid}}",
                      "value": {
                        "type": "Handlebars",
                        "templateString": "{{agreements.length}}"
                      }
                    },
                    "renderStrategy": {
                      "type": "rows",
                      "values": [
                        {
                          "type": "registry",
                          "registryResource": "remoteKb",
                          "registryRenderFunction": "agreementsList",
                          "props": [
                            {
                              "name": "remoteId",
                              "value": {
                                "type": "access",
                                "accessType": "JSONPath",
                                "expression": "$.uuid"
                              }
                            }
                          ]
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    }
  }
}
